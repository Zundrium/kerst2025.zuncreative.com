<script>
	//
	// GitHub van deze gsplat viewer
	// https://github.com/mkkellogg/GaussianSplats3D
	//
	import * as GaussianSplats3D from "@mkkellogg/gaussian-splats-3d";

	const viewer = new GaussianSplats3D.Viewer({
		cameraUp: [0, -1, 0],
		initialCameraPosition: [-40, -50, -40],
		initialCameraLookAt: [0, -15, 0],
		sharedMemoryForWorkers: false,
	});

	viewer
		.addSplatScene(
			"/geom/scene_opti.ksplat",
			{
				splatAlphaRemovalThreshold: 5,
				sceneRevealMode: GaussianSplats3D.SceneRevealMode.Instant,
				showLoadingUI: false, // Disable default UI
				gpuAcceleratedSort: true,
				sharedMemoryForWorkers: true,
				halfPrecisionCovariancesOnGPU: true,
				optimizeSplatData: true,
				sphericalHarmonicsDegree: 0,
				enableOptionalEffects: false,
				renderMode: GaussianSplats3D.RenderMode.OnChange,
				antialiased: false,
				sceneFadeInRateMultiplier: 1000000,
				position: [0, 1, 0],
				rotation: [0, 0, 0, 1],
				scale: [1.5, 1.5, 1.5],
			},
			(progress: any) => {
				// Dispatch progress event
				console.log("Scene progress:", progress);
				window.dispatchEvent(
					new CustomEvent("scene-progress", { detail: { progress } }),
				);
			},
			(error: any) => {
				// Dispatch error event
				window.dispatchEvent(
					new CustomEvent("scene-error", { detail: { error } }),
				);
			},
			() => {
				// Dispatch load event
				console.log("Scene loaded");
			},
		)
		.then(() => {
			viewer.start();

			setTimeout(() => {
				// Dispatch loaded event
				window.dispatchEvent(new Event("scene-loaded"));
			}, 3000);
		});
</script>
