---

---

<div id="loading-screen">
    <div class="loader-content">
        <div class="spinner"></div>
        <!-- Removed text as per request -->
    </div>
</div>

<style>
    #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #c0392b; /* Christmas Red Background */
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        transition:
            opacity 0.5s ease,
            visibility 0.5s ease;
    }

    #loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    .loader-content {
        text-align: center;
    }

    .spinner {
        margin: 0 auto 1rem;
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    h2 {
        font-family: "Georgia", serif;
        margin-bottom: 0.5rem;
    }
</style>

<script>
    const loadingScreen = document.getElementById("loading-screen");
    const progressText = document.getElementById("loading-progress");

    // Listen for progress events from ThreeScene
    window.addEventListener("scene-progress", ((e: CustomEvent) => {
        if (progressText) {
            progressText.innerText = `${Math.round(e.detail.progress)}%`;
        }
    }) as EventListener);

    window.addEventListener("scene-loaded", () => {
        if (loadingScreen) {
            loadingScreen.classList.add("hidden");
            // Trigger the dialog to open shortly after
            setTimeout(() => {
                window.dispatchEvent(new Event("show-christmas-card"));
                window.dispatchEvent(new Event("start-experience"));
            }, 500);
        }
    });

    // Fallback if scene load event fails or takes too long (optional safety)
    // setTimeout(() => {
    //     if (loadingScreen && !loadingScreen.classList.contains('hidden')) {
    //        loadingScreen.classList.add('hidden');
    //     }
    // }, 10000);
</script>
